<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/index.css" rel="stylesheet">
    <title>Teacher Dashboard</title>
</head>

<script src="https://cdn.tailwindcss.com"></script>

<body class="bg-grey-300 h-screen p-4 flex">

<!-- User Menu -->
<div class="flex flex-col w-1/5 mx-4 p-4 bg-green-50">
    <div class="flex items-center">
        <div>
            <div class="text-xl font-bold w-8 h-8">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="0.75"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
            </div>
            <div class="text-gray-500">Teacher ID</div>
        </div>
    </div>

    <button class='mt-8 bg-green-200 p-1'>
        Class Assignment
    </button>
    <button class='mt-2 bg-green-200 p-1'>
        My Schedule
    </button>

    <button class="mt-4 bg-gray-200 hover:bg-gray-300 text-black font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline"
            onclick="location.href='/index.html'">
        Log Out
    </button>
</div>

<!-- Forms -->
<div class="flex-col w-2/3 p-4 bg-gray-100">
    <!-- Add Assignment Form -->
    <form id="addAssignmentForm" class="flex flex-col my-12 w-full">
        <label for="class">Class:</label>
        <select id="class" name="class">
            <option value="1">Level 1 A</option>
            <option value="2">Level 1 B</option>
            <option value="4">Level 2 A</option>
            <option value="3">Level 3</option>
            <option value="5">Level 4</option>
        </select>
        <label for="assignment" class='mt-2'>Assignment:</label>
        <textarea id="assignment" name="assignment" rows='4'></textarea>
        <button type="submit" class="bg-amber-200 hover:bg-amber-500 mt-2 ">Add Assignment</button>
    </form>
    <p id="message"></p>
    <button id="displayAssignmentsBtn" class="bg-green-100 p-2 my-4">Show all the assignments</button>
    <div id="displayAssignment" class="bg-gray-200"></div>

    <!-- Personal Schedule Form -->

</div>

<script type="module">
    import {createClient} from '@supabase/supabase-js'

    const supabaseUrl = 'https://qdzhecspothfvernvdms.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkemhlY3Nwb3RoZnZlcm52ZG1zIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTY4ODA2MDYxMSwiZXhwIjoyMDAzNjM2NjExfQ.0GTDV2EgHtrsGRfEC6c4bizr-iEzGwFWE3aHgoSJq3s';
    const supabase = createClient(supabaseUrl, supabaseKey);
    const addAssignmentForm = document.getElementById('addAssignmentForm')
    const displayAssignmentBtnEL = document.getElementById('displayAssignmentsBtn');

    // Function to add an assignment to the "assignment" table in Supabase
    async function addAssignment(e) {
        e.preventDefault(); // Prevent the default form submission behavior

        const classSelect = document.getElementById('class');
        const assignmentTextarea = document.getElementById('assignment');

        const classValue = classSelect.value;
        const assignmentValue = assignmentTextarea.value;

        try {
            const {data, error} = await supabase
                .from('assignment')
                .insert([{class: classValue, assignment: assignmentValue}]);

            if (error) {
                console.error('Error adding assignment:', error.message);
            } else {
                console.log('Assignment added successfully:', data);

                // Show success message on the page
                const message = document.getElementById('message');
                message.textContent = `New assignment has been added to the class.`;

                // Clear the form after successful submission
                classSelect.value = 'level1A'; // Set default class value
                assignmentTextarea.value = ''; // Clear the assignment text
            }
        } catch (error) {
            console.error('Error adding assignment:', error.message);
            message.textContent = `Three is an error adding assignment.`
        }
    }

    // Add event listener to the form for form submission handling
    addAssignmentForm.addEventListener('submit', addAssignment);

    async function displayAssignments() {
        const displayAssignmentEL= document.getElementById('displayAssignment');

        try {
            const {data: assignments, error} = await supabase
                .from('assignment')
                .select('*');

            if (error) {
                console.error('Error retrieving assignments:', error.message);
            } else {
                console.log('Retrieving assignments successfully:', assignments);

                // Create an array of assignment strings with the desired format using .map
                const assignmentList = assignments.map((assignment) => {
                    return `Class: ${assignment.class}, Assignment: ${assignment.assignment}`;
                });

                // Set the innerHTML of displayAssignmentEL to show the assignments
                displayAssignmentEL.innerHTML = assignmentList.join('<br>');
            }
        } catch (error) {
            console.error('Error retrieving assignments:', error.message);
        }
    }

    // Add event listener to trigger the displayAssignments function when the button is clicked
    displayAssignmentBtnEL.addEventListener('click', displayAssignments);


</script>


</body>
</html>
